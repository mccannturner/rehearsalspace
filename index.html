<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Rehearsal Space</title>

    <!-- Fonts -->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link
        href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600&family=Poppins:wght@500;600&display=swap"
        rel="stylesheet"
    >

    <style>
        :root {
            --bg: #F5EDE3;
            --card-bg: #FFFFFF;
            --border: #E0E0E0;
            --text-main: #111111;
            --text-muted: #666666;
            --primary: #39393F;       /* Dark Graphite */
            --primary-soft: #EEE9E0;
        }

        * {
            box-sizing: border-box;
        }

        body {
            margin: 0;
            padding: 0;
            font-family: "Inter", system-ui, -apple-system, BlinkMacSystemFont, "Segoe UI", sans-serif;
            background: radial-gradient(circle at top left, #FFFFFF, var(--bg));
            color: var(--text-main);
        }

        .app-shell {
            min-height: 100vh;
            display: flex;
            flex-direction: column;
        }

        header {
            padding: 16px 32px;
            border-bottom: 1px solid #E6E6EA;
            background: rgba(255, 255, 255, 0.9);
            backdrop-filter: blur(10px);
            display: flex;
            align-items: center;
            justify-content: space-between;
        }

        .brand {
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .brand-logo {
            display: flex;
            align-items: center;
            gap: 10px;
        }

.brand-mark {
    width: 40px;
    height: 40px;
    border-radius: 14px;
    background: #39393F;  /* ‚Üê Remove this line if your logo has its own background */
    display: flex;
    align-items: center;
    justify-content: center;
    box-shadow: 0 6px 14px rgba(0, 0, 0, 0.12);
}

        .brand-mark svg {
    width: 40px;
    height: 40px;
}

        .brand-text {
            display: flex;
            flex-direction: column;
        }

        .brand-name {
            font-family: "Poppins", system-ui, sans-serif;
            font-size: 20px;
            font-weight: 600;
            letter-spacing: 0.02em;
            color: #111111;
        }

        .brand-tagline {
            font-size: 12px;
            color: var(--text-muted);
        }

        .header-meta {
            font-size: 12px;
            color: var(--text-muted);
        }

        main {
            flex: 1;
            padding: 24px 32px 32px;
        }

        .layout {
            display: grid;
            grid-template-columns: 2fr 1.5fr;
            grid-template-rows: auto auto 1fr;
            grid-gap: 16px 16px;
        }

        .card {
            background: var(--card-bg);
            border-radius: 14px;
            border: 1px solid var(--border);
            padding: 16px 18px;
            box-shadow: 0 8px 18px rgba(0, 0, 0, 0.03);
        }

        .card-header {
            display: flex;
            align-items: baseline;
            justify-content: space-between;
            margin-bottom: 10px;
        }

        .card-title {
            font-family: "Poppins", system-ui, sans-serif;
            font-size: 15px;
            font-weight: 500;
        }

        .icon-title {
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .card-subtitle {
            font-size: 11px;
            color: var(--text-muted);
        }

        label {
            font-size: 13px;
            color: var(--text-muted);
        }

        input[type="text"],
        input[type="number"] {
            font-family: inherit;
            font-size: 13px;
            padding: 6px 8px;
            border-radius: 8px;
            border: 1px solid var(--border);
            outline: none;
            min-width: 0;
            background: #FBFBFD;
        }

        input[type="text"]:focus,
        input[type="number"]:focus {
            border-color: var(--primary);
            background: #FFFFFF;
        }

        button {
            font-family: inherit;
            font-size: 13px;
            padding: 6px 12px;
            border-radius: 999px;
            border: none;
            cursor: pointer;
            background: var(--primary);
            color: white;
            font-weight: 500;
            letter-spacing: 0.01em;
            display: inline-flex;
            align-items: center;
            gap: 6px;
        }

        button:hover {
            background: #26262B;
        }

        button.secondary {
            background: var(--primary-soft);
            color: var(--primary);
        }

        button.secondary:hover {
            background: #e0d8cc;
        }

        hr {
            border: none;
            border-top: 1px solid var(--border);
            margin: 12px 0;
        }

        .section-row {
            display: flex;
            align-items: center;
            gap: 8px;
            margin-bottom: 8px;
            flex-wrap: wrap;
        }

        .section-column {
            display: flex;
            flex-direction: column;
            gap: 6px;
        }

        #beat-indicator {
            width: 18px;
            height: 18px;
            border-radius: 999px;
            border: 1px solid #C0C0C7;
            margin-left: 4px;
            transition: background-color 0.05s ease;
        }

        .small-label {
            font-size: 11px;
            color: var(--text-muted);
        }
.band-section-title {
    font-size: 11px;
    font-weight: 600;
    text-transform: uppercase;
    letter-spacing: 0.05em;
    color: #888888;
    margin-bottom: 4px;
}

.band-room-name {
    font-size: 13px;
    font-weight: 500;
}
        /* Chat */
        #chat-messages {
            border-radius: 10px;
            border: 1px solid var(--border);
            padding: 8px;
            height: 150px;
            overflow-y: auto;
            background: #FBFBFD;
            font-size: 12px;
        }

        #chat-input {
            width: 100%;
            font-size: 13px;
            padding: 6px 8px;
            border-radius: 999px;
            border: 1px solid var(--border);
            outline: none;
            background: #FBFBFD;
        }

        #chat-input:focus {
            border-color: var(--primary);
            background: #FFFFFF;
        }

        .chat-input-row {
            display: flex;
            gap: 8px;
            margin-top: 6px;
        }

        /* Sliders */
        input[type="range"] {
            width: 160px;
        }

        .slider-row {
            display: flex;
            align-items: center;
            justify-content: space-between;
            gap: 12px;
        }

        .slider-row label {
            flex: 1;
        }

        .slider-row input[type="range"] {
            flex: 1.2;
        }

        /* Recording */
        #recordings a {
            display: inline-block;
            margin-top: 6px;
            font-size: 12px;
            color: var(--primary);
            text-decoration: none;
        }

        #recordings a:hover {
            text-decoration: underline;
        }
        .recording-banner {
    margin-top: 8px;
    font-size: 11px;
    padding: 6px 10px;
    border-radius: 999px;
    display: inline-flex;
    align-items: center;
    gap: 6px;
}

.recording-banner-idle {
    background: #F5F5F7;
    color: #555555;
}

.recording-banner-armed {
    background: #FFF4E5;
    color: #8A4B00;
}

.recording-banner-live {
    background: #FDECEA;
    color: #D64545;
}

.recording-banner-saving {
    background: #E7F3FF;
    color: #1A4FA3;
}

.recording-dot {
    width: 8px;
    height: 8px;
    border-radius: 50%;
    background: currentColor;
}
        /* Latency */
        .latency-row {
            display: flex;
            align-items: center;
            justify-content: space-between;
            gap: 8px;
            margin-top: 4px;
        }

        .latency-dot {
            display: inline-block;
            width: 10px;
            height: 10px;
            border-radius: 50%;
            margin-right: 4px;
        }

        #latency-display {
            font-size: 12px;
            color: var(--text-muted);
        }
        
        .latency-debug {
            margin-top: 6px;
            padding: 6px 8px;
            border-radius: 8px;
            background: #F8F4EC;
            font-size: 11px;
            color: var(--text-muted);
        }

        #latency-stats {
            margin-top: 2px;
        }

        /* User list */
        #user-list {
            list-style: none;
            padding-left: 0;
            margin: 6px 0 0;
            font-size: 12px;
            color: var(--text-muted);
        }

        #user-list li::before {
            content: "‚Ä¢ ";
            color: var(--primary);
        }

        /* Room status */
        #room-status {
            font-size: 13px;
            margin: 0 0 4px;
        }

        .status-pill {
            display: inline-flex;
            align-items: center;
            gap: 6px;
            padding: 3px 10px;
            border-radius: 999px;
            background: var(--primary-soft);
            font-size: 11px;
            color: var(--primary);
        }

        .status-dot {
            width: 6px;
            height: 6px;
            border-radius: 50%;
            background: #C0C0C7; /* neutral gray */
    }

        /* Layout specifics */
        .card-room {
            grid-column: 1 / 2;
            grid-row: 1 / 2;
        }

        .card-chat {
            grid-column: 1 / 2;
            grid-row: 2 / 4;
        }

        .card-metronome {
            grid-column: 2 / 3;
            grid-row: 1 / 2;
        }

        .card-recording {
            grid-column: 2 / 3;
            grid-row: 2 / 3;
        }

        .card-mixer {
            grid-column: 2 / 3;
            grid-row: 3 / 4;
        }
.card-locked {
    opacity: 0.6;
}

.card-locked input,
.card-locked button {
    cursor: not-allowed;
}
.card-locked .card-subtitle::after {
    content: " ‚Ä¢ Recording active";
    color: #D64545;
    font-weight: 500;
}

/* Tabs */
#tab-bar {
    display: flex;
    gap: 8px;
    border-top: 1px solid var(--border);
    padding-top: 8px;
    margin-top: 12px;
    flex-wrap: wrap;
}

#tab-bar button {
    font-size: 12px;
    padding: 4px 10px;
}

#tab-bar button.active {
    background: var(--primary);
    color: #fff;
}

#tab-panels {
    margin-top: 12px;
}

.tab-panel {
    display: none;
}

.tab-panel.active {
    display: block;
}

@media (max-width: 900px) {
    main {
        padding: 16px;
    }

    .layout {
        grid-template-columns: 1fr;
        grid-template-rows: auto;
    }

    .card-room,
    .card-recording,
    .card-tabs {
        grid-column: 1 / 2;
        grid-row: auto;
    }

    /* Tab bar: bigger tap targets on mobile */
    #tab-bar {
        display: flex;
        gap: 6px;
        margin-top: 8px;
        overflow-x: auto;
        -webkit-overflow-scrolling: touch;
    }

    #tab-bar button {
        flex: 1;
        padding: 10px 0;
        font-size: 13px;
        text-align: center;
        white-space: nowrap;
    }

    /* Recording card: less cramped on small screens */
    .card-recording .section-row {
        flex-direction: column;
        align-items: stretch;
        gap: 4px;
    }

    .card-recording #record {
        width: 100%;
        justify-content: center;
    }

    .card-recording input[type="text"] {
        width: 100%;
    }

    /* Make text areas in tabs breathe a bit more */
    .tab-panel {
        margin-top: 8px;
    }
}

        /* Splash screen */
        #splash {
            position: fixed;
            inset: 0;
            z-index: 999;
            background: radial-gradient(circle at top, #FFFFFF, #F5EDE3);
            display: flex;
            align-items: center;
            justify-content: center;
            transition: opacity 0.4s ease;
        }

        #splash.splash-hide {
            opacity: 0;
            pointer-events: none;
        }

        .splash-inner {
            display: flex;
            flex-direction: column;
            align-items: center;
            gap: 12px;
            padding: 24px 28px;
            border-radius: 18px;
            background: rgba(255, 255, 255, 0.9);
            box-shadow: 0 18px 40px rgba(0, 0, 0, 0.12);
        }

.splash-logo-mark {
    width: 96px;
    height: 96px;
    border-radius: 28px;
    background: #39393F;  /* ‚Üê Remove this line if your logo has its own background */
    display: flex;
    align-items: center;
    justify-content: center;
    box-shadow: 0 18px 48px rgba(0, 0, 0, 0.22);
}

        .splash-logo-mark svg {
    width: 90px;
    height: 90px;
}

        .splash-title {
            font-family: "Poppins", system-ui, sans-serif;
            font-size: 20px;
            font-weight: 600;
            letter-spacing: 0.03em;
            color: #111111;
        }

        .splash-subtitle {
            font-size: 13px;
            color: #666666;
        }

        .splash-meta {
            font-size: 11px;
            color: #999999;
        }
    </style>
</head>
<body>

<!-- Splash -->
<div id="splash">
    <div class="splash-inner">
        <div class="splash-logo-mark">
    <img src="assets/rehearsal-space-1024.png" alt="Rehearsal Space" style="width: 100%; height: 100%; object-fit: contain;">
</div>
        <div class="splash-title">Rehearsal Space</div>
        <div class="splash-subtitle">Setting up your space‚Ä¶</div>
        <div class="splash-meta">Audio engine ‚Ä¢ Local prototype</div>
    </div>
</div>

<div class="app-shell">
    <header>
        <div class="brand">
            <div class="brand-logo">
                <div class="brand-mark">
    <img src="assets/rehearsal-space-1024.png" alt="Rehearsal Space" style="width: 100%; height: 100%; object-fit: contain;">
</div>
                <div class="brand-text">
                    <div class="brand-name">Rehearsal Space</div>
                    <div class="brand-tagline">Rehearse remotely. Show up ready.</div>
                </div>
            </div>
        </div>
        <div class="header-meta">
            Remote rehearsal room ‚Ä¢ Runs in your browser
        </div>
    </header>

    <main>
        <div class="layout">

            <!-- Session -->
            <div class="card card-room">
                <div class="card-header">
                    <div class="card-title">
                        <span class="icon-title">
                            <!-- Session icon -->
                            <svg width="18" height="18" viewBox="0 0 24 24"
                                 fill="none" stroke="#2C2C2E" stroke-width="1.75"
                                 stroke-linecap="round" stroke-linejoin="round">
                              <rect x="3" y="4" width="18" height="14" rx="3" />
                              <circle cx="9" cy="11" r="2.5" fill="#39393F" />
                              <circle cx="15" cy="11" r="2.5" />
                            </svg>
                            Session
                        </span>
                    </div>
                    <div class="card-subtitle">Start a remote rehearsal for your band</div>
                </div>

                <div class="section-row" style="margin-bottom: 12px;">
                    <label>
                        Room name
                        <br>
                        <input id="room" type="text" placeholder="e.g. sunday-rehearsal">
                    </label>
                    <button id="start">
                        Join Room
                    </button>
                </div>

                    <!-- Nickname -->
<div class="section-row">
    <label for="nickname">Your Name</label>
    <input type="text" id="nickname" placeholder="Enter your name" maxlength="20">
</div>

                <hr>

<div class="section-column">
    <div id="room-status">Not in a room</div>

    <div class="latency-row">
        <div id="latency-display">Latency: -- (waiting for other users)</div>
        <div class="status-pill" id="audio-status-pill">
            <span class="status-dot" id="audio-status-dot"></span>
            <span id="audio-status-text">Not in room</span>
        </div>
    </div>

    <div class="small-label" style="margin-top: 6px;">
        For band members, open the <strong>Band</strong> tab below to see users, invites, and latency details.
    </div>
</div>
                </div>
            </div>

<!-- Recording -->
<div class="card card-recording">
  <div class="card-header">
    <div class="card-title">
      <span class="icon-title">
        <!-- Recording icon -->
        <svg width="18" height="18" viewBox="0 0 24 24"
             fill="none" stroke="#2C2C2E" stroke-width="1.75"
             stroke-linecap="round" stroke-linejoin="round">
          <circle cx="12" cy="12" r="4" fill="#39393F"/>
        </svg>
        Recording
      </span>
    </div>
    <div class="card-subtitle">Capture takes to review later</div>
  </div>

  <div class="section-column" style="gap: 8px;">
    <div class="section-row">
      <button id="record">Start Recording</button>
      <span class="small-label">Records your mix (mic + remote/backing), not the metronome.</span>
    </div>

    <div class="section-row">
      <div id="backing-status" class="small-label">
        No backing track loaded.
      </div>
    </div>

    <div class="section-row">
      <label class="small-label">
        <input id="use-backing" type="checkbox">
        Use backing track while recording (if available)
      </label>
    </div>

<div class="section-row" style="margin-top: 4px;">
  <span class="small-label" style="color: #111111;">
    üí° Tip: Wear headphones when recording with backing tracks to avoid echo
  </span>
</div>

    <div class="section-row">
      <label class="small-label">
        Take label<br>
        <input id="take-label" type="text" placeholder="e.g. Verse idea, Chorus transition" style="min-width: 220px;">
      </label>
    </div>
  </div>

  <div id="recordings"></div>

  <!-- Global recording state banner -->
  <div id="recording-banner" class="recording-banner recording-banner-idle">
    <span class="recording-dot"></span>
    Session idle. Ready to record.
  </div>
</div> <!-- ‚úÖ recording card ends here -->


<!-- Tabs: Chat / Band / Mixer / Settings -->
<div class="card card-tabs">
  <div class="card-header">
    <div class="card-title">
      Workspace
    </div>
    <div class="card-subtitle">Chat, band, mixer & settings</div>
  </div>

  <!-- Tab bar -->
<div id="tab-bar">
  <button type="button" data-tab-target="chat" class="active">Chat</button>
  <button type="button" data-tab-target="band">Band</button>
  <button type="button" data-tab-target="mixer">Mixer</button>
  <button type="button" data-tab-target="recordings">Recordings</button>
  <button type="button" data-tab-target="metronome">Metronome</button>
</div>

  <!-- Tab panels -->
  <div id="tab-panels">
    <!-- CHAT TAB -->
    <div class="tab-panel active" data-tab="chat">
      <div class="card-header">
        <div class="card-title">
          <span class="icon-title">
            <!-- Chat icon -->
            <svg width="18" height="18" viewBox="0 0 24 24"
                 fill="none" stroke="#2C2C2E" stroke-width="1.75"
                 stroke-linecap="round" stroke-linejoin="round">
              <path d="M4 5h16v10H7l-3 3V5z"/>
              <circle cx="10" cy="10" r="1.5" fill="#39393F"/>
              <circle cx="14" cy="10" r="1.5"/>
            </svg>
            Chat
          </span>
        </div>
        <div class="card-subtitle">Capture notes and decisions while you rehearse</div>
      </div>

      <div id="chat-messages"></div>
      <div class="chat-input-row">
        <input id="chat-input" type="text" placeholder="Type a message and press Enter...">
        <button id="chat-send" class="secondary">Send</button>
      </div>
    </div>

    <!-- BAND TAB -->
<div class="tab-panel" data-tab="band">
  <div class="section-column" style="gap: 12px;">

    <!-- Room & status -->
    <div>
      <div class="band-section-title">Room</div>
      <div id="room-status" class="band-room-name">Not in a room</div>
    </div>

    <!-- Latency & audio health -->
    <div>
      <div class="band-section-title">Connection</div>
      <div class="latency-row">
        <div id="latency-display">Latency: -- (waiting for other users)</div>
        <div class="status-pill" id="audio-status-pill">
          <span class="status-dot" id="audio-status-dot"></span>
          <span id="audio-status-text">Not in room</span>
        </div>
      </div>

      <div class="latency-debug">
        <div class="small-label">Latency details</div>
        <div id="latency-stats">
          Avg: -- ms ¬∑ Min: -- ¬∑ Max: -- ¬∑ Jitter: -- ms (0 samples)
        </div>
      </div>
    </div>

    <!-- Users -->
    <div>
      <div class="band-section-title">In this room</div>
      <ul id="user-list"></ul>
    </div>

    <!-- Invite -->
    <div>
      <div class="band-section-title">Invite your band</div>
      <div class="section-row" style="margin-top: 4px;">
        <input id="invite-link" type="text" readonly placeholder="Join a room to get an invite link">
        <button id="invite-copy" class="secondary">Copy link</button>
      </div>
      <div id="invite-copied" class="small-label" style="display:none; margin-top:4px;">
        ‚úÖ Link copied!
      </div>
    </div>

  </div>
</div>

    <!-- MIXER TAB -->
    <div class="tab-panel" data-tab="mixer">
      <div class="card-header">
        <div class="card-title">
          <span class="icon-title">
            <!-- Mixer icon -->
            <svg width="18" height="18" viewBox="0 0 24 24"
                 fill="none" stroke="#2C2C2E" stroke-width="1.75"
                 stroke-linecap="round" stroke-linejoin="round">
              <line x1="6"  y1="4"  x2="6"  y2="20"/>
              <line x1="12" y1="4"  x2="12" y2="20"/>
              <line x1="18" y1="4"  x2="18" y2="20"/>
              <rect x="4"  y="9"  width="4" height="4" rx="2" fill="#39393F"/>
              <rect x="10" y="6"  width="4" height="4" rx="2"/>
              <rect x="16" y="12" width="4" height="4" rx="2"/>
            </svg>
            Monitor & Mix
          </span>
        </div>
        <div class="card-subtitle">Control how loud your bandmates are in your headphones</div>
      </div>

      <div class="section-column" style="gap: 10px;">
        <div class="slider-row">
          <label>Remote volume</label>
          <input id="remote-volume" type="range" min="0" max="100" value="100">
        </div>

<!-- Your Mic Effects -->
<div class="section-row">
    <label class="small-label">Your Mic Tone</label>
    <input type="range" id="tone-control" min="-10" max="10" value="0" step="1">
    <span id="tone-value" class="small-label">Neutral</span>
</div>

<div class="section-row">
    <label class="small-label">Your Mic Reverb</label>
    <input type="range" id="reverb-control" min="0" max="100" value="0">
    <span id="reverb-value" class="small-label">0%</span>
</div>

        <label class="small-label">
          <input id="mute-remote" type="checkbox">
          Mute remote audio
        </label>
      </div>

      <div style="margin-top: 10px;">
        <div class="small-label">Band mix (per user):</div>
        <div id="user-mixer" class="section-column" style="gap: 6px; margin-top: 4px;"></div>
      </div>
    </div>

    <!-- RECORDINGS TAB -->
    <div class="tab-panel" data-tab="recordings">
      <div class="card-header">
        <div class="card-title">
          <span class="icon-title">
            <!-- Recordings icon -->
            <svg width="18" height="18" viewBox="0 0 24 24"
                 fill="none" stroke="#2C2C2E" stroke-width="1.75"
                 stroke-linecap="round" stroke-linejoin="round">
              <rect x="4" y="4" width="16" height="16" rx="3"/>
              <circle cx="12" cy="12" r="3" fill="#39393F"/>
              <circle cx="18" cy="8" r="1"/>
            </svg>
            Recordings
          </span>
        </div>
        <div class="card-subtitle">Previous takes saved on this device</div>
      </div>

      <div class="section-column" style="gap: 8px;">
        <div class="small-label">
          These recordings live in your browser only (per device). Use them as backing tracks or for quick reference.
        </div>

        <div id="recordings-list" class="section-column" style="gap: 8px; margin-top: 6px;">
          <!-- Filled by script.js -->
        </div>
      </div>
    </div>

    <!-- Metronome TAB -->
    <div class="tab-panel" data-tab="metronome">
      <div class="card-header">
        <div class="card-title">
          <span class="icon-title">
            <!-- Metronome icon -->
            <svg width="18" height="18" viewBox="0 0 24 24"
                 fill="none" stroke="#2C2C2E" stroke-width="1.75"
                 stroke-linecap="round" stroke-linejoin="round">
              <path d="M6 20h12L12 3 6 20z"/>
              <line x1="12" y1="8" x2="17" y2="14" stroke="#39393F"/>
            </svg>
            Metronome
          </span>
        </div>
        <div class="card-subtitle">Shared tempo and click for the session</div>
      </div>

      <div class="section-row">
        <label>
          BPM
          <br>
          <input id="bpm" type="number" value="120" min="30" max="300">
        </label>
        <button id="metronome">
          Start Metronome
        </button>
      </div>

      <div class="section-row">
        <label>
          Time signature
          <br>
          <select id="time-signature" style="padding: 4px 8px; border-radius: 8px; border: 1px solid var(--border); background:#FBFBFD; font-size:13px;">
            <option value="4">4/4</option>
            <option value="3">3/4</option>
            <option value="2">2/4</option>
            <option value="6">6/8</option>
          </select>
        </label>
      </div>

      <div class="section-row">
        <label class="small-label">
          <input id="share-metronome" type="checkbox">
          Share metronome with room
        </label>
        <div style="display:flex; align-items:center; gap:6px;">
          <span class="small-label">Beat</span>
          <div id="beat-indicator"></div>
        </div>
      </div>

      <div class="section-column" style="margin-top: 10px; gap: 8px;">
        <div class="slider-row">
          <label>Metronome volume</label>
          <input id="metronome-volume" type="range" min="0" max="100" value="70">
        </div>
      </div>
    </div>
  </div> <!-- /#tab-panels -->
</div> <!-- /.card-tabs -->
  </div>

            </div>

        </div>
    </main>
</div>

<script src="script.js"></script>
<script src="https://cdn.jsdelivr.net/npm/eruda"></script>
<script>eruda.init();</script>
</body>
</html>
